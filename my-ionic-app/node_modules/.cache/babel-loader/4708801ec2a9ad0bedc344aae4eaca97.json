{"ast":null,"code":"import axios from 'axios';\nimport { getLogger } from '../core';\nconst log = getLogger('itemApi');\nconst baseUrl = 'localhost:3000';\nconst itemUrl = `http://${baseUrl}/item`;\n\nfunction withLogs(promise, fnName) {\n  log(`${fnName} - started`);\n  return promise.then(res => {\n    log(`${fnName} - succeeded`);\n    return Promise.resolve(res.data);\n  }).catch(err => {\n    log(`${fnName} - failed`);\n    return Promise.reject(err);\n  });\n}\n\nconst config = {\n  headers: {\n    'Content-Type': 'application/json'\n  }\n};\nexport const getItems = () => {\n  return withLogs(axios.get(itemUrl, config), 'getItems');\n};\nexport const createItem = item => {\n  return withLogs(axios.post(itemUrl, item, config), 'createItem');\n};\nexport const updateItem = item => {\n  return withLogs(axios.put(`${itemUrl}/${item.id}`, item, config), 'updateItem');\n};\nexport const newWebSocket = onMessage => {\n  const ws = new WebSocket(`ws://${baseUrl}`);\n\n  ws.onopen = () => {\n    log('web socket onopen');\n  };\n\n  ws.onclose = () => {\n    log('web socket onclose');\n  };\n\n  ws.onerror = error => {\n    log('web socket onerror', error);\n  };\n\n  ws.onmessage = messageEvent => {\n    log('web socket onmessage');\n    onMessage(JSON.parse(messageEvent.data));\n  };\n\n  return () => {\n    ws.close();\n  };\n};","map":{"version":3,"sources":["G:/Mihnea/Facultate/anu 3/Mobile/start/my-ionic-app/src/class/itemApi.tsx"],"names":["axios","getLogger","log","baseUrl","itemUrl","withLogs","promise","fnName","then","res","Promise","resolve","data","catch","err","reject","config","headers","getItems","get","createItem","item","post","updateItem","put","id","newWebSocket","onMessage","ws","WebSocket","onopen","onclose","onerror","error","onmessage","messageEvent","JSON","parse","close"],"mappings":"AAAA,OAAOA,KAAP,MAAkB,OAAlB;AACA,SAASC,SAAT,QAA0B,SAA1B;AAGA,MAAMC,GAAG,GAAGD,SAAS,CAAC,SAAD,CAArB;AAEA,MAAME,OAAO,GAAG,gBAAhB;AACA,MAAMC,OAAO,GAAI,UAASD,OAAQ,OAAlC;;AAMA,SAASE,QAAT,CAAqBC,OAArB,EAAyDC,MAAzD,EAAqF;AACnFL,EAAAA,GAAG,CAAE,GAAEK,MAAO,YAAX,CAAH;AACA,SAAOD,OAAO,CACXE,IADI,CACCC,GAAG,IAAI;AACXP,IAAAA,GAAG,CAAE,GAAEK,MAAO,cAAX,CAAH;AACA,WAAOG,OAAO,CAACC,OAAR,CAAgBF,GAAG,CAACG,IAApB,CAAP;AACD,GAJI,EAKJC,KALI,CAKEC,GAAG,IAAI;AACZZ,IAAAA,GAAG,CAAE,GAAEK,MAAO,WAAX,CAAH;AACA,WAAOG,OAAO,CAACK,MAAR,CAAeD,GAAf,CAAP;AACD,GARI,CAAP;AASD;;AAED,MAAME,MAAM,GAAG;AACbC,EAAAA,OAAO,EAAE;AACP,oBAAgB;AADT;AADI,CAAf;AAMA,OAAO,MAAMC,QAAoC,GAAG,MAAM;AACxD,SAAOb,QAAQ,CAACL,KAAK,CAACmB,GAAN,CAAUf,OAAV,EAAmBY,MAAnB,CAAD,EAA6B,UAA7B,CAAf;AACD,CAFM;AAIP,OAAO,MAAMI,UAAqD,GAAGC,IAAI,IAAI;AAC3E,SAAOhB,QAAQ,CAACL,KAAK,CAACsB,IAAN,CAAWlB,OAAX,EAAoBiB,IAApB,EAA0BL,MAA1B,CAAD,EAAoC,YAApC,CAAf;AACD,CAFM;AAIP,OAAO,MAAMO,UAAqD,GAAGF,IAAI,IAAI;AAC3E,SAAOhB,QAAQ,CAACL,KAAK,CAACwB,GAAN,CAAW,GAAEpB,OAAQ,IAAGiB,IAAI,CAACI,EAAG,EAAhC,EAAmCJ,IAAnC,EAAyCL,MAAzC,CAAD,EAAmD,YAAnD,CAAf;AACD,CAFM;AAWP,OAAO,MAAMU,YAAY,GAAIC,SAAD,IAA4C;AACtE,QAAMC,EAAE,GAAG,IAAIC,SAAJ,CAAe,QAAO1B,OAAQ,EAA9B,CAAX;;AACAyB,EAAAA,EAAE,CAACE,MAAH,GAAY,MAAM;AAChB5B,IAAAA,GAAG,CAAC,mBAAD,CAAH;AACD,GAFD;;AAGA0B,EAAAA,EAAE,CAACG,OAAH,GAAa,MAAM;AACjB7B,IAAAA,GAAG,CAAC,oBAAD,CAAH;AACD,GAFD;;AAGA0B,EAAAA,EAAE,CAACI,OAAH,GAAaC,KAAK,IAAI;AACpB/B,IAAAA,GAAG,CAAC,oBAAD,EAAuB+B,KAAvB,CAAH;AACD,GAFD;;AAGAL,EAAAA,EAAE,CAACM,SAAH,GAAeC,YAAY,IAAI;AAC7BjC,IAAAA,GAAG,CAAC,sBAAD,CAAH;AACAyB,IAAAA,SAAS,CAACS,IAAI,CAACC,KAAL,CAAWF,YAAY,CAACvB,IAAxB,CAAD,CAAT;AACD,GAHD;;AAIA,SAAO,MAAM;AACXgB,IAAAA,EAAE,CAACU,KAAH;AACD,GAFD;AAGD,CAlBM","sourcesContent":["import axios from 'axios';\r\nimport { getLogger } from '../core';\r\nimport { ItemProps } from './ItemProps';\r\n\r\nconst log = getLogger('itemApi');\r\n\r\nconst baseUrl = 'localhost:3000';\r\nconst itemUrl = `http://${baseUrl}/item`;\r\n\r\ninterface ResponseProps<T> {\r\n  data: T;\r\n}\r\n\r\nfunction withLogs<T>(promise: Promise<ResponseProps<T>>, fnName: string): Promise<T> {\r\n  log(`${fnName} - started`);\r\n  return promise\r\n    .then(res => {\r\n      log(`${fnName} - succeeded`);\r\n      return Promise.resolve(res.data);\r\n    })\r\n    .catch(err => {\r\n      log(`${fnName} - failed`);\r\n      return Promise.reject(err);\r\n    });\r\n}\r\n\r\nconst config = {\r\n  headers: {\r\n    'Content-Type': 'application/json'\r\n  }\r\n};\r\n\r\nexport const getItems: () => Promise<ItemProps[]> = () => {\r\n  return withLogs(axios.get(itemUrl, config), 'getItems');\r\n}\r\n\r\nexport const createItem: (item: ItemProps) => Promise<ItemProps[]> = item => {\r\n  return withLogs(axios.post(itemUrl, item, config), 'createItem');\r\n}\r\n\r\nexport const updateItem: (item: ItemProps) => Promise<ItemProps[]> = item => {\r\n  return withLogs(axios.put(`${itemUrl}/${item.id}`, item, config), 'updateItem');\r\n}\r\n\r\ntype MessageData = {\r\n  event: string;\r\n  payload: {\r\n    item: ItemProps;\r\n  };\r\n}\r\n\r\nexport const newWebSocket = (onMessage: (data: MessageData) => void) => {\r\n  const ws = new WebSocket(`ws://${baseUrl}`)\r\n  ws.onopen = () => {\r\n    log('web socket onopen');\r\n  };\r\n  ws.onclose = () => {\r\n    log('web socket onclose');\r\n  };\r\n  ws.onerror = error => {\r\n    log('web socket onerror', error);\r\n  };\r\n  ws.onmessage = messageEvent => {\r\n    log('web socket onmessage');\r\n    onMessage(JSON.parse(messageEvent.data));\r\n  };\r\n  return () => {\r\n    ws.close();\r\n  }\r\n}\r\n"]},"metadata":{},"sourceType":"module"}